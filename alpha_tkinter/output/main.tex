\documentclass{mytex}
\usepackage{xcolor}
\usepackage{fontawesome5}
\usepackage{babel}
\usepackage{tcolorbox}
\usepackage{tikz}
\usetikzlibrary{positioning, arrows.meta}
\usepackage{pgf-umlcd}
\usepackage{array}
\usepackage{booktabs}
\usepackage{amsmath} % Pour les flèches
\usepackage{setspace}
\usepackage{hyperref}

\title{Rapport ECL - Template} %Titre du fichier

\begin{document}

%----------- Informations du rapport ---------

\titre{Analyse de données} %Titre du fichier .pdf
\UE{SAÉ S2.04} %Nom de la UE
\sujet{Statistiques} %Nom du sujet

\eleves{Baptiste \textsc{Lavogiez}}

\enseignant{Marie \textsc{Deletombe}}

%----------- Initialisation -------------------
        
\fairemarges %Afficher les marges
\fairepagedegarde %Créer la page de garde
\tabledematieres %Créer la table de matières

%------------ Corps du rapport ----------------

\section{Contexte} 

Cette partie décrit le modèle de bases de données utilisé. Elle ne constitue pas une réponse au sujet statistique mais un rappel du contexte choisi.
AAA

\subsection {Introduction}
Ce \textbf{rapport} présentera la mise en forme d'une base de données en nous appuyant sur les Jeux Olympiques (environ 270 000 lignes, 15 colonnes) au format \emph{CSV}. Nous allons d'abord importer les données, pour ensuite les \emph{ventiler}, soit les ranger dans des tables plus adaptées afin de décompoeser les données au mieux. Lors de la partie \emph{SQL}, nous travaillerons sur un serveur \emph{PostgreSQL}.

\subsection{Données brutes}

Nous obtenons le fichier suivant, pesant près de 40 Mo.

\insererfigure{img/fichier_explorateur.png}{0.65cm}{Aperçu dans l'explorateur}{Label de la figure}

\insererfigure{img/fichier_apercu.png}{4cm}{Aperçu du fichier}{Label de la figure}

\subsection{Observations}
Nous constatons alors que bon nombre de données sont répétées et c'est normal, car nous nous situons dans un fichier brut.

Nous pouvons distinguer plusieurs tables possibles : 

\begin{itemize}
	\item Des athlètes,
	\item Des jeux,
	\item Des sports,
	\item Des délégations...
\end{itemize}

Passons maintenant à la conception de ce modèle !

\subsection{Le Modèle Logique de Données (MLD)}

\textbf{\emph{Un Modèle Logique de Données}} est une façon de représenter un schéma de tables sous une forme à la fois graphique et textuelle.

\tsec{Tables}

Nous en déduisons, après réflexion, près de 7 tables différentes : 

\insererfigure{img/version1/uml.png}{13cm}{Diagramme UML}{fig::v1::uml}
La logique utilisée est :

\begin{itemize}
	\item Une clé primaire est nommée par la première lettre du nom de la table, suivi de \emph{"no"},
	\item Une clé primaire est soulignée,
	\item Une clé étrangère est précédée d'un dièse \emph{"\#"}.
\end{itemize}

\tsec{Raccourcis}
On peut penser à Participation(\#ano, \#noc), ce qui serait possible, mais en réalité cette table est inutile car un athlète qui fait partie d’une nation revient au même qu’un athlète qui participe pour une nation (dans Participation).
De plus, un athlète peut concourir pour une nation une fois, puis pour une autre une autre fois.

\tsec{Précisions}
Quelques explications sur des nommages qui peuvent ne pas être explicites :

\begin{itemize}
	\item Un \textbf{\emph{NOC}} veut dire \textbf{National Olympic Committee}. Exemple : États-Unis --> USA. Il est unique pour le cas des Jeux Olympiques.
	\item Une discipline est un sous-genre d'un sport. Exemple : Natation --> 4x100m relais. Ce sera utile pour les épreuves.
	\item Pour le reste, les raisons seront comprises lors de l'éxécution des requêtes.
\end{itemize}

\section{Présentation du sujet}

\subsection{Énoncé}

Ce sujet traitera des Jeux Olympiques, avec pour objectif d'analyser leurs données avec une démarche statistique.

\subsection{Traitement des questions}

Nous aurons donc à répondre à différentes questions statistiques, autant à l'aide de requêtes sur la base de données que d'outils statistiques (formules, graphiques...).

Enfin, afin d'aller plus loin, nous imaginerons d'autres études statistiques en \textbf{allant plus loin que le sujet initial}.

Toutes les réponses \textbf{seront illustrées par des graphiques appropriés}.

\subsection{Forme des requêtes}

Par convention, les requêtes et les tables sont écrites en anglais.
La commande \\copy, ou \\o en SQL nous permettra de générer des fichiers CSV à partir de la sortie des requêtes.
Malheureusement, PostgreSQL oblige à tout écrire sur une seule ligne sans pouvoir indenter, alors qu'il serait plus lisible d'aérer les requêts, surtout les plus denses.

\begin{codeboxlang}{SQL}
\copy (SELECT AVG(Participations.age) AS age_moyen_global FROM Participations;) TO 'average_global_age.csv' CSV HEADER
\end{codeboxlang}


\emph{Ici, on requête l'âge global et on le copie dans un fichier.}

De cette façon, dans le rapport, les requêtes seront aérées, sans la commande, et les fichiers, eux, auront la forme ci-dessus.

Ces fichiers seront utiles pour mieux analyser les données, en utilisant notamment l'outil https://www.rawgraphs.io/ qui, prenant en entrée un jeu de données, permet sa visualisation sous une multitude de formats.
Tous ces fichiers sont disponibles dans la racine de ce document.

\section{Questions du sujet}

Cette partie traitera des questions relatives au sujet.

\subsection{Partie 1}

\tsec{Déterminer les 20 athlètes affichant le plus de participations aux J.O. (tout sexe confondu)}

\begin{codeboxlang}[title=20 athlètes affichant le plus de participations]{SQL}
	SELECT Athletes.name, COUNT(Participations.ano) AS nombre_participations
	FROM Athletes JOIN Participations USING(ano)
	GROUP BY Athletes.name
	ORDER BY nombre_participations DESC
	LIMIT 20;
\end{codeboxlang}

\res{\insererfigure{img/version1/20ath.png}{12cm}{20 athlètes les plus actifs}{fig::v1::20ath}}

\subsection{Partie 2}

Cette partie \textbf{statistique} traitera d'une édition précise, et unique vis-à-vis de la promotion, des Jeux Olympiques.

Notre édition sera les Jeux d'Été de 1984, à Los Angeles, aux États-Unis.
Les JO d'été étant plus suivis et avec plus d'épreuves, il y aura donc plus de données à visualiser qu'en hiver, et ce afin d'avoir une étude statistique plus précise et plus permissive en terme d'options !

\tsecnonum{Précision}

Afin de sélectionner les jeux de 1984 dans la table, chaque requête utilisera la vue suivante (cette partie ne s'appuie que sur la table \emph{Participations})

\begin{codeboxlang}[title=Vue exclusive à 1984]{SQL}
	CREATE VIEW Participations1984 AS (
		SELECT Participations.* 
		FROM Participations
		JOIN Events USING(eno)
		JOIN Games USING(gno)
		WHERE Games.games = '1984 Summer'
	);
\end{codeboxlang}

\tsec{Remplir le tableau statistique}

\begin{codeboxlang}[title=Tableau statistique complet]{SQL}
	SELECT Delegations.region, AVG(Participations.age) AS average_age, COUNT(DISTINCT Participations.ano) AS number_of_athletes, MIN(Participations.age) AS min_age, MAX(Participations.age) AS max_age
	FROM Delegations JOIN Participations USING(noc)
	WHERE Delegations.region IS NOT NULL
	GROUP BY Delegations.region
	ORDER BY average_age DESC;
\end{codeboxlang}

\res{\insererfigure{img/version2/tableau_statistique.png}{11cm}{Tableau statistique généré}{v2::tab_stat_gen}}

Pour l'anecdote, les Émirats Arabes Unis apparaissent en haut car l'âge de leurs participants (au nombre de 7) n'est pas renseigné.
C'était leur première participation aux JO, et ils n'ont pas eu de médaillés.

\href{https://en.wikipedia.org/wiki/United\_Arab\_Emirates\_at\_the\_1984\_Summer\_Olympics}{UAE en 1984}

Note : Les âges non renseignés sont exclus lors du calcul de la moyenne, mais pas du nombre d'athlètes.
La moyenne d'âge n'est donc pas entièrement représentative, mais elle est plus juste que si on avait pris en compte les âges non renseignés.

\tsec{Comparer l’âge moyen des médaillés et l’âge moyen des participants (tout sexe confondu)}

On cherche d'abord l'âge des médaillés, puis celui des participants.
\emph{Les participants incluent donc tout le monde, y compris les médaillés.}

\begin{codeboxlang}[title=Âge moyen des médaillés]{SQL}
	SELECT AVG(Participations.age) AS age_moyen_medailles
	FROM Participations1984
	WHERE medal IS NOT NULL ;
\end{codeboxlang}

\res{24.24}

\begin{codeboxlang}[title=Âge moyen des participants]{SQL}
	SELECT AVG(Participations.age) AS age_moyen_participants
	FROM Participations1984 ;
\end{codeboxlang}

\res{24.00}

\comp{Les médaillés sont en moyenne 6 mois plus jeunes que les participants.}
\comp{Les participants sont 2\% plus âgés que les médaillés.}

\tsec{Comparer le poids moyen des médaillés et le poids moyen des participants (distinguer les
hommes et les femmes)}

\tsecnonum{Hommes}

\begin{codeboxlang}[title=Poids moyen des médaillés hommes]{SQL}
	SELECT AVG(Participations.weight)
	FROM Participations1984
	JOIN Athletes USING (ano)
	WHERE medal IS NOT NULL
	AND sex='M'
\end{codeboxlang}

\res{78.89}

\begin{codeboxlang}[title=Poids moyen des hommes]{SQL}
	SELECT AVG(Participations.weight)
	FROM Participations1984
	JOIN Athletes USING (ano)
	AND sex='M'
\end{codeboxlang}

\res{74.41}

\comp{On observe que les hommes médaillés sont plus lourds que les hommes participants, de 4480 grammes en moyenne.}
\comp{Soit une différence de 6\%.}

\tsecnonum{Femmes}

\begin{codeboxlang}[title=Poids moyen des médaillées femmes]{SQL}
	SELECT AVG(Participations.weight)
	FROM Participations1984
	JOIN Athletes USING (ano)
	WHERE medal IS NOT NULL
	AND sex='F'
\end{codeboxlang}

\res{62.16}

\begin{codeboxlang}[title=Poids moyen des femmes]{SQL}
	SELECT AVG(Participations.weight)
	FROM Participations1984
	JOIN Athletes USING (ano)
	AND sex='F'
\end{codeboxlang}

\res{58.02}

\comp{On observe que les femmes médaillées sont plus lourdes que les femmes participantes, de 4140 grammes en moyenne.}
\comp{Soit une différence de 7,13\%.}

\obs{On observe plus ou moins la même tendance chez les deux genres, avec une différence étant sensiblement la même ; les médaillés sont plus lourds que les participants.}


\subsection{Partie 3}

\tsecnonum{Sur la période 1992 à 2016, faire la liste des 15 pays qui ont gagné le plus de médailles
cumulées sur cette période (jeux d’été et hiver confondus)}

\begin{codeboxlang}[title=Top 15 régions par médailles]{sql}
	SELECT region, COUNT(medal) AS medals_number
	FROM Participations
	JOIN Delegations USING(noc)
	JOIN Events USING(eno)
	JOIN Games USING(gno)
	WHERE Games.year BETWEEN 1992 AND 2016
	GROUP BY region
	ORDER BY medals_number DESC
	LIMIT 15;
\end{codeboxlang}

\res{\insererfigure{img/version3/top15.png}{7cm}{Classement}{fig::v3::top15}}

\tsecnonum{Choisir 5 pays parmi ces 15 et, pour chacun d’eux, représenter l’évolution}

Nous choisirons : 
\begin{itemize}
\item Australie
\item Chine (RPC)
\item Italie
\item Espagne
\item Royaume-Uni
\end{itemize}

En s'appuyant sur la vue suivante, les requêtes seront raccourcies.

On ne va pas inclure le résultat à chaque fois pour ne pas surcharger, car l'étude statistique sera présente et incluera ces résultats.


\begin{codeboxlang}[title=Vue exclusive à 1992-2016 et aux 5 pays]{sql}
	CREATE VIEW ParticipationsPart3 AS (
	SELECT Participations.*, year, region
	FROM Participations
	JOIN Delegations USING(noc)
	JOIN Events USING(eno)
	JOIN Games USING(gno)
	WHERE Games.year BETWEEN 1992 AND 2016
	AND region IN ('Australia', 'China', 'Italy', 'Spain', 'UK')
	);
\end{codeboxlang}

\tsecnonum{Représentation des évolutions}

Les résultats des requêtes sont sauvegardées dans des fichiers CSV correspondants.
Ces fichiers sont utilisés en entrée d'un petit programme Python (matplotlib) dessinant un nuage de points correspondant aux données regroupées par pays et par jeu. Ce programme calcule également une droite de régression afin de représenter l'évolution globale des données selon leur corrélation. Dans certains cas et selon les paramètres, nous aurons une extrapolation ou une interpolation et il en sera jugé en commentaire. Cette droite ne vaut pas pour vérité absolue et parfois elle ne sera pas fiable.

\textbf{Il est à noter que la largeur des cases est différente car entre un Jeu d'Hiver et un Jeu d'Été, il y a 1 an et demi d'écart alors que dans le cas contrainte, il y a 2 ans et demi d'écart.
}
\tsec{Du nombre de participants}

\begin{codeboxlang}[title=Nombre de participants]{sql}
	SELECT region, games, COUNT(DISTINCT ano) AS contestants_number
	FROM ParticipationsPart3
	GROUP BY region, games
	ORDER BY games ASC, contestants_number DESC;
\end{codeboxlang}

\insererfigure{img/version3/b1.png}{8.8cm}{Graphique d'évolution - B1}{fig::v3::b1}

\obs{Une observation intéressante est de constater que lorsque le pays est hôte, comme l'Australie en 2000 à Sydney ou la Chine en 2008 à Pékin, il concentre beaucoup plus de participants (et c'est assez logique car en marge de ces évènements beaucoup d'investissements sportifs sont lancés). En dehors de ces évènements, on distingue peu d'évolution.}

\obs{La régression est probablement fortement influencée par le fait des pays hôtes concentrant plus de participants à cette occasion. Désigner une évolution globale pour ces pays n'est donc pas totalement vrai à en voir ces écarts.}

\tsec{Du nombre de médaillés}

\begin{codeboxlang}[title=Nombre de médaillés]{sql}
	SELECT region, games, COALESCE(COUNT(NULLIF(medal IS NULL, true)), 0) AS medals_number
	FROM ParticipationsPart3
	GROUP BY region, games
	ORDER BY games ASC, medals_number DESC;
\end{codeboxlang}

\insererfigure{img/version3/b2.png}{8.8cm}{Graphique d'évolution - B2}{fig::v3::b2}

\obs{Dire qu'il y a plus de médaillés est une affirmation dépendant en réalité des pays que l'on traite et de l'évolution de leurs niveaux sportifs. L'Italie a relativement stagné alors que la Chine a beaucoup augmenté (en 2008 à Pékin notamment) ainsi que l'Australie (en 2000 à Sydney).}

\tsec{Du nombre de femmes participantes}

\begin{codeboxlang}[title=Nombre de femmes participantes par pays et année]{sql}
	SELECT region, games, COUNT(DISTINCT ano) AS women_contestants_number
	FROM ParticipationsPart3
	JOIN Athletes USING(ano)
	WHERE sex = 'F'
	GROUP BY region, games
	ORDER BY region ASC, games ASC, women_contestants_number DESC;
\end{codeboxlang}

\res{\insererfigure{img/version3/nbfemmes.png}{10cm}{Nombre de femmes participantes}{fig::v3::nbfemmes}}

\insererfigure{img/version3/b3.png}{8.8cm}{Graphique d'évolution - B3}{fig::v3::b3}
	
\obs{Il y a aujourd'hui de plus en plus de femmes participantes ! Cependant, les jeux d'hiver ont moins participants, donc moins de participantes. Il faut veiller à bien analyser les points pour cette affirmation.}

\tsec{De la proportion de femmes participantes (en comparaison de la proportion d'hommes)}

\begin{codeboxlang}[title=Proportion de femmes participantes par rapport aux hommes par pays et année]{sql}
	SELECT region, games, COUNT(CASE WHEN sex = 'F' THEN 1 END) * 1.0 / NULLIF(COUNT(CASE WHEN sex = 'M' THEN 1 END), 0) AS women_over_men
	FROM ParticipationsPart3
	JOIN Athletes USING(ano)
	GROUP BY region, games
	ORDER BY region ASC, games ASC, women_over_men DESC;
\end{codeboxlang}

\insererfigure{img/version3/b4.png}{8.8cm}{Graphique d'évolution - B4}{fig::v3::b4}

\obs{Les points sont assez rapprochés ; nous pouvons ici compter sur une régression de qualité nous informant que le rapport femmes/hommes parmi les médaillés a pu augmenter de 0.71 (35\% de femmes et 65\% d'hommes) à 1.01 en moyenne (50\% des deux côtés). La situation est, en 2016, dans les pays et selon l'évolution, égalitaire.}

\obs{Les prochaines questions traiteront du nombre de personnes médaillés et non de médailles : j'ai cru avoir fait une erreur donc j'ai beaucoup regardé car les comptes ne suivaient pas mais en réalité, il s'agit souvent d'épreuves collectives (rugby, relais, football...). Par conséquent, il y a donc très souvent plus de personnes médaillées que de médailles}

\tsec{De la proportion de médaillées parmi les femmes}

\begin{codeboxlang}[title=Proportion de médaillées parmi les femmes]{sql}
	WITH WomenParticipation AS (
	SELECT region, games, COUNT(DISTINCT ano) AS total_women
	FROM ParticipationsPart3
	JOIN Athletes USING(ano)
	WHERE sex = 'F'
	GROUP BY region, games
	),
	
	MedalsWomen AS (
	SELECT region, games, COUNT(DISTINCT ano) AS medal_women
	FROM ParticipationsPart3
	JOIN Athletes USING(ano)
	WHERE sex = 'F' AND medal IS NOT NULL
	GROUP BY region, games
	)
	
	SELECT wp.region, wp.games, COALESCE(mw.medal_women * 100.0 / NULLIF(wp.total_women, 0) / 100.0, 0) AS medal_women_proportion_over_women
	FROM WomenParticipation wp
	LEFT JOIN MedalsWomen mw USING(region, games)
	ORDER BY region ASC, wp.games ASC, medal_women_proportion_over_women DESC;
\end{codeboxlang}

\insererfigure{img/version3/b5.png}{8.8cm}{Graphique d'évolution - B5}{fig::v3::b5}

\obs{Les résultats sont très dispersés et on ne peut pas vraiment constater une vraie dynamique.
La régression nous informe néanmoins que la proportion a quand même augmenté de 0.05 sur la période donnée.}

\obs{Cependant, la régression n'est pas vraiment fiable car il y a trop d'écart entre les valeurs. Une bonne régression doit habituellement concentrer beaucoup de points sur sa ligne et les points sont trop éloignés pour le permettre. Dans cette situation, analyser l'évolution a peu de sens.}

\tsec{De la proportion de femmes parmi les médaillés}

\begin{codeboxlang}[title=Proportion de femmes parmi les médaillées]{sql}
	WITH AllCombinations AS (
	SELECT DISTINCT region, games
	FROM ParticipationsPart3
	),
	
	MedalsPeople AS (
	SELECT region, games, COUNT(DISTINCT ano) AS count_medal
	FROM ParticipationsPart3
	WHERE medal IS NOT NULL
	GROUP BY region, games
	),
	
	MedalsWomen AS (
	SELECT region, games, COUNT(DISTINCT ano) AS count_medal_women
	FROM ParticipationsPart3
	JOIN Athletes USING(ano)
	WHERE sex = 'F' AND medal IS NOT NULL
	GROUP BY region, games
	)
	
	SELECT ac.region, ac.games, COALESCE(mw.count_medal_women * 100.0 / NULLIF(mp.count_medal, 0) / 100.0, 0) AS medal_women_proportion_over_global
	FROM AllCombinations ac
	LEFT JOIN MedalsPeople mp USING(region, games)
	LEFT JOIN MedalsWomen mw USING(region, games)
	ORDER BY ac.region ASC, ac.games ASC, medal_women_proportion_over_global DESC;
\end{codeboxlang}

\insererfigure{img/version3/b6.png}{8.8cm}{Graphique d'évolution - B6}{fig::v3::b6}

\obs{Le rendu ressemble un peu au précédent, néanmoins on peut distinguer plus clairement les écarts entre les pays, avec moins de droites se coupant. La progression par année tend vers une égalité parfaite (0.50), avec pour ces pays et dans cette période, une fin démontrant que la proportion de femmes parmi les médaillés est égale à celle des hommes.}

\obs{Les jeux d'hiver sont en réalité un peu le cadeau empoisonné de ce jeu de données. En effet, il y a 5 à 10 fois moins de participants, donc les résultats sont très sensibles au hasard (exemple : 8 participants, 0 médailles, donc 0 alors que même une médaille aurait fait 0.125). Ainsi, on se retrouve à compter les proportions d'hiver et d'été au même niveau alors qu'en réalité elles concernent des nombres de participants bien différents. Les proportions à étudier devraient être les jeux d'été car ayant plus de données. Cependant, si l'objet d'études est l'évolution uniquement, combiner les deux saisons n'est pas un problème.}

\obs{Sur ces exemples, on peut globalement constater : 
\begin{itemize}
	\item Une hausse du niveau des femmes
	\item Une proportion devenant égale à celle des hommes
	\item Une meilleure représentation parmi les participants
\end{itemize}}

\obs{En conclusion, ces évolutions peuvent avoir du sens selon la qualité et la corrélation des données entre elles. Sans ces paramètres, ces évolutions peuvent parfois être utiles, mais en y prêtant une grande attention tout de même. Dans tous les cas, on préfère une régression de qualité. Il faut aussi rappeler que ces évolutions ne valent que pour les pays sélectionnés et pour la période. La Chine a toujours eu plus d'inclusion féminine aux Jeux, donc l'ensemble est un peu tiré vers le haut de ce fait.}

\section{Pour aller plus loin}

\tsecnonum{Ici, nous allons plus loin que le sujet !}

Nous nous baserons ici sur tous les pays.

\tsec{L'impact du changement de poids des athlètes}

J'aurais aimé faire une requête concernant les athlètes qui ont changé de poids et l'impact de ce changement sur leur poids, or la base n'admet qu'un seul poids unique pour chaque athlète. Il en va de même pour la taille (qui ne peut logiquement pas changer après 20 ans).

\tsec{L'âge moyen des médaillés d'un sport}

On pense souvent qu'il faut être jeune dans le sport. Ici nous analyserons quelles disciplines et quels sports demandent une préparation dès la jeunesse.

\tsecnonum{Par "discipline"}

\begin{codeboxlang}[title=Age moyen des médaillés par discipline]{sql}
	SELECT event, coalesce(ROUND(AVG(age),2),0) as average_age
	FROM Participations
	JOIN Events USING(eno)
	JOIN Disciplines USING(dno)
	WHERE medal IS NOT NULL
	GROUP BY event
	ORDER BY average_age desc;
\end{codeboxlang}

\res{\insererfigure{img/version4/disciplinerange.png}{12cm}{Age moyen des médaillés par discipline}{fig::v4::discrange}}

\tsecnonum{Par "sport"}

\begin{codeboxlang}[title=Age moyen des médaillés par sport]{sql}
	SELECT sport, coalesce(ROUND(AVG(age),2),0) as average_age
	FROM Participations
	JOIN Events USING(eno)
	JOIN Disciplines USING(dno)
	WHERE medal IS NOT NULL
	GROUP BY sport
	ORDER BY average_age desc;
\end{codeboxlang}

\res{\insererfigure{img/version4/sportrange.png}{12cm}{Age moyen des médaillés par sport}{fig::v4::sportrange}}

\obs{Les sports avec les médaillés les plus âgés en moyenne sont des sports étant plus relatifs à une longue expérience.}

\tsec{Le physique fait-il la différence ?}

Avons-nous réellement plus de chances d'être médaillé si nous avons le corps parfait pour notre sport ?

\tsecnonum{Le physique des médaillés}

\begin{codeboxlang}[title=Physique des médaillés par sport]{sql}
	CREATE VIEW BodyMedalStats AS (
	SELECT sport, COALESCE(AVG(height),0) AS avg_height, COALESCE(AVG(weight),0) AS avg_weight
	FROM Participations
	JOIN Events USING(eno)
	JOIN Disciplines USING(dno)
	WHERE medal IS NOT NULL
	GROUP BY sport
	);
\end{codeboxlang}

\res{\insererfigure{img/version4/bodymedal.png}{10cm}{Physique des médaillés par sport}{fig::v4::bodymedal}}

\tsecnonum{Le physique des non médaillés}

\begin{codeboxlang}[title=Physique des non-médaillés par sport]{sql}
	CREATE VIEW BodyNoMedalStats AS (
	SELECT sport, COALESCE(AVG(height),0) AS avg_height, COALESCE(AVG(weight),0) AS avg_weight
	FROM Participations
	JOIN Events USING(eno)
	JOIN Disciplines USING(dno)
	WHERE medal IS NULL
	GROUP BY sport
	);
\end{codeboxlang}

\res{\insererfigure{img/version4/bodynomedal.png}{10cm}{Physique des non-médaillés par sport}{fig::v4::bodynomedal}
}

\tsecnonum{Les plus grands favorisés}

\begin{codeboxlang}[title=]{sql}
	SELECT sport, b1.avg_height - b2.avg_height AS height_diff
	FROM BodyMedalStats b1
	JOIN BodyNoMedalStats b2 USING(sport) 
	WHERE b1.avg_height - b2.avg_height > 0
	ORDER BY height_diff DESC;
\end{codeboxlang}

\res{\insererfigure{img/version4/heightplus.png}{10cm}{}{fig::v4::taller}}

\tsecnonum{Les plus petits favorisés}

\begin{codeboxlang}[title=]{sql}
	SELECT sport, b1.avg_height - b2.avg_height AS height_diff
	FROM BodyMedalStats b1
	JOIN BodyNoMedalStats b2 USING(sport) 
	WHERE b1.avg_height - b2.avg_height < 0
	ORDER BY height_diff DESC;
\end{codeboxlang}

\res{\insererfigure{img/version4/heightneg.png}{10cm}{}{fig::v4::smaller}}

\tsecnonum{Les plus lourds favorisés}

\begin{codeboxlang}[title=]{sql}
	SELECT sport, b1.avg_weight - b2.avg_weight AS weight_diff
	FROM BodyMedalStats b1
	JOIN BodyNoMedalStats b2 USING(sport) 
	WHERE b1.avg_weight - b2.avg_weight > 0
	ORDER BY weight_diff DESC;
\end{codeboxlang}

\res{\insererfigure{img/version4/weightplus.png}{10cm}{}{fig::v4::heavier}}

\tsecnonum{Les plus maigres favorisés}
\begin{codeboxlang}[title=]{sql}
	SELECT sport, b1.avg_weight - b2.avg_weight AS weight_diff
	FROM BodyMedalStats b1
	JOIN BodyNoMedalStats b2 USING(sport) 
	WHERE b1.avg_weight - b2.avg_weight < 0
	ORDER BY weight_diff DESC;
\end{codeboxlang}

\res{\insererfigure{img/version4/weightneg.png}{10cm}{}{fig::v4::thin}}

\tsecnonum{Les résultats sont-ils cohérents ?}

\obs{On observe sans surprise que le basketball ou la nage ont des médaillés en moyenne plus grands. L'inverse vaut également pour la gymnastique. Les autres différences peuvent également être sociologiques étant dû au mode de vie des médaillés, notamment pour le poids, avec des médaillés de tennis de tables en moyenne 1.73kg moins lourds que les non médaillés. Néanmoins aux Jeux quelqu'un de non médaillé reste tout de même un grand sportif qui a su se hisser aux plus grandes compétitions de son sport, donc il est déjà plus probable qu'il satisfasse les critères physiques de sa discipline que n'importe qui (Basketball : les non-médaillés font 1m90 en moyenne).}


\merci

\end{document}


